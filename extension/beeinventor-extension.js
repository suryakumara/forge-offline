(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function t(e,t,n,o,r,i,a){try{var l=e[i](a),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(o,r)}function n(e){return function(){var n=this,o=arguments;return new Promise((function(r,i){var a=e.apply(n,o);function l(e){t(a,r,i,l,s,"next",e)}function s(e){t(a,r,i,l,s,"throw",e)}l(void 0)}))}}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){function t(o,i){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r(this,"addCustomRestrictedArea",function(){var e=n(regeneratorRuntime.mark((function e(t,n,o){var r,i,l,s,c,u,d,v,f,m,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>0)){e.next=24;break}return e.next=3,a.viewer.loadExtension("Autodesk.Viewing.SceneBuilder");case 3:return r=e.sent,e.next=6,r.addNewModel({modelNameOverride:"box",conserveMemory:!1});case 6:i=e.sent,l=new THREE.MeshBasicMaterial({color:new THREE.Color(1,0,0),transparent:!0,opacity:.5}),s=[],n.forEach((function(e){s.push(new THREE.Vector2(e.x,e.y))})),c=new THREE.Shape(s),u=new THREE.ShapeGeometry(c),d={amount:null!=o?o:1,bevelEnabled:!1},(v=new THREE.ExtrudeGeometry(c,d)).computeFaceNormals(),u.computeFaceNormals(),f=(new THREE.BufferGeometry).fromGeometry(v),a.customRestrictedArea=new THREE.Mesh(f,l),a.customRestrictedArea.userData.id=t,m=a.idToNumber(t),a.customRestrictedArea.dbId=parseInt("".concat(5003,m)),i.addMesh(a.customRestrictedArea),h=i.model,a.objects.set(t,h);case 24:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}()),r(this,"addAOA",function(){var e=n(regeneratorRuntime.mark((function e(t,n,o){var r,i,l,s,c,u,d,v,f,m,h,p,y,g,E,b,w,T,R,A,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.viewer.loadExtension("Autodesk.Viewing.SceneBuilder");case 2:return c=e.sent,e.next=5,c.addNewModel({modelNameOverride:"aoa",conserveMemory:!1});case 5:u=e.sent,d=new THREE.MeshPhongMaterial({color:new THREE.Color(.863,.078,.235),opacity:.8,transparent:!0}),v=new THREE.TorusGeometry(.5,.05,13,50),f=new THREE.BoxGeometry(.5,1,1),m=new THREE.TextGeometry("AOA".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),(h=new THREE.Mesh(m,d)).matrix.makeRotationX(-4.7),h.matrix.setPosition(new THREE.Vector3(0,0,.7)),h.matrix.scale(new THREE.Vector3(.2,.2,.2)),(p=new THREE.Mesh(f,d)).matrix.scale(new THREE.Vector3(.5,.5,.5)),y=new THREE.Mesh(v,d),g=Math.PI/180*90,y.matrix.makeRotationX(g),y.matrix.makeRotationY(g),y.matrix.setPosition(new THREE.Vector3(.2,0,0)),y.matrix.scale(new THREE.Vector3(.2,.2,.2)),(E=new THREE.Mesh(v,d)).matrix.makeRotationX(g),E.matrix.makeRotationY(g),E.matrix.setPosition(new THREE.Vector3(.3,0,0)),E.matrix.scale(new THREE.Vector3(.3,.3,.3)),(b=new THREE.Mesh(v,d)).matrix.makeRotationX(g),b.matrix.makeRotationY(g),b.matrix.setPosition(new THREE.Vector3(.4,0,0)),b.matrix.scale(new THREE.Vector3(.4,.4,.4)),(w=new THREE.Geometry).merge(h.geometry,h.matrix),w.merge(p.geometry,p.matrix),w.merge(y.geometry,y.matrix),w.merge(E.geometry,E.matrix),w.merge(b.geometry,b.matrix),w.computeVertexNormals(),T=(new THREE.BufferGeometry).fromGeometry(w),a.aoa=new THREE.Mesh(T,d),a.aoa.userData.id=t,R=a.idToNumber(t),a.aoa.dbId=parseInt("".concat(5001,R)),u.addMesh(a.aoa),A=u.model,(x=new THREE.Matrix4).makeRotationZ(null!==(r=o[1])&&void 0!==r?r:Math.PI/180*0),x.setPosition(new THREE.Vector3(null!==(i=n[0])&&void 0!==i?i:0,null!==(l=n[1])&&void 0!==l?l:0,null!==(s=n[2])&&void 0!==s?s:2)),A.setPlacementTransform(x),a.objects.set(t,A);case 51:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}()),r(this,"addNewWorker",function(){var e=n(regeneratorRuntime.mark((function e(t,n,o){var r,i,l,s,c,u,d,v,f,m,h,p,y,g,E,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.viewer.loadExtension("Autodesk.Viewing.SceneBuilder");case 2:return s=e.sent,e.next=5,s.addNewModel({modelNameOverride:"box",conserveMemory:!1});case 5:c=e.sent,u=new THREE.Geometry,d=new THREE.MeshPhongMaterial({color:new THREE.Color(.863,.078,.235)}),v=new THREE.SphereGeometry(.5,32,16),f=new THREE.SphereGeometry(.4,32,16),m=new THREE.TextGeometry("W: ".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),(h=new THREE.Mesh(m,d)).matrix.makeRotationX(-4.7),h.matrix.setPosition(new THREE.Vector3(0,0,2.8)),h.matrix.scale(new THREE.Vector3(.2,.2,.2)),p=new THREE.Mesh(v,d),y=new THREE.Mesh(f,d),p.matrix.setPosition(new THREE.Vector3(0,0,2.3)),p.matrix.scale(new THREE.Vector3(.5,.5,.5)),y.matrix.setPosition(new THREE.Vector3(0,0,1)),y.matrix.scale(new THREE.Vector3(.5,.5,2.5)),u.merge(p.geometry,p.matrix),u.merge(y.geometry,y.matrix),u.merge(h.geometry,h.matrix),u.computeVertexNormals(),g=(new THREE.BufferGeometry).fromGeometry(u),a.humanModel=new THREE.Mesh(g,d),a.humanModel.userData.id=t,E=a.idToNumber(t),a.humanModel.dbId=parseInt("".concat(5002,E)),c.addMesh(a.humanModel),(b=c.model).setPlacementTransform((new THREE.Matrix4).compose(new THREE.Vector3(null!==(r=n[0])&&void 0!==r?r:0,null!==(i=n[1])&&void 0!==i?i:0,null!==(l=n[2])&&void 0!==l?l:0),new THREE.Quaternion(0,0,0,1),new THREE.Vector3(1,1,1))),a.objects.set(t,b);case 34:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}()),r(this,"addRestrictedArea",function(){var e=n(regeneratorRuntime.mark((function e(t,n,o){var r,i,l,s,c,u,d,v,f,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.viewer.loadExtension("Autodesk.Viewing.SceneBuilder");case 2:return s=e.sent,e.next=5,s.addNewModel({modelNameOverride:"box",conserveMemory:!1});case 5:c=e.sent,u=new THREE.BoxGeometry(1,1,1),d=new THREE.MeshPhongMaterial({color:new THREE.Color(1,0,0),opacity:.5,transparent:!0}),v=(new THREE.BufferGeometry).fromGeometry(u),a.restrictedArea=new THREE.Mesh(v,d),a.restrictedArea.userData.id=t,f=a.idToNumber(t),a.restrictedArea.dbId=parseInt("".concat(5003,f)),c.addMesh(a.restrictedArea),(m=c.model).setPlacementTransform((new THREE.Matrix4).setPosition({x:null!==(r=n[0])&&void 0!==r?r:0,y:null!==(i=n[1])&&void 0!==i?i:0,z:null!==(l=n[2]+.5)&&void 0!==l?l:0})),a.objects.set(t,m);case 18:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}()),r(this,"addExcavator",function(){var e=n(regeneratorRuntime.mark((function e(t,n,o){var r,i,l,s,c,u,d,v,f,m,h,p,y,g,E,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.viewer.loadExtension("Autodesk.Viewing.SceneBuilder");case 2:return s=e.sent,e.next=5,s.addNewModel({modelNameOverride:"box",conserveMemory:!1});case 5:c=e.sent,u=new THREE.MeshPhongMaterial({color:new THREE.Color(1,0,0)}),(d=THREE.ImageUtils.loadTexture("".concat("http://localhost:3000","/assets/images/png/img_gps_plant_online-3.png"))).minFilter=THREE.LinearFilter,v=new THREE.MeshBasicMaterial({map:d,side:THREE.DoubleSide}),f=new THREE.BoxGeometry(1,1,1),(m=new THREE.TextGeometry("EXT-".concat(t),{font:"monaco",size:1,height:0,curveSegments:3})).computeBoundingBox(),(h=new THREE.Mesh(m,u)).matrix.makeRotationX(-4.7),h.matrix.setPosition(new THREE.Vector3(0,.5,1)),h.matrix.scale(new THREE.Vector3(.2,.2,.2)),(p=new THREE.Mesh(f,u)).matrix.scale(new THREE.Vector3(2,2,1)),(y=new THREE.Geometry).merge(h.geometry,h.matrix),y.merge(p.geometry,p.matrix),y.computeVertexNormals(),g=(new THREE.BufferGeometry).fromGeometry(y),a.excavator=new THREE.Mesh(g,v),a.excavator.userData.id=t,E=a.idToNumber(t),a.excavator.dbId=parseInt("".concat(5004,E)),c.addMesh(a.excavator),(b=c.model).setPlacementTransform((new THREE.Matrix4).setPosition({x:null!==(r=n[0])&&void 0!==r?r:0,y:null!==(i=n[1])&&void 0!==i?i:0,z:null!==(l=n[2]+1)&&void 0!==l?l:0})),a.objects.set(t,b);case 33:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}()),r(this,"addBeacon",function(){var e=n(regeneratorRuntime.mark((function e(t,n,o){var r,i,l,s,c,u,d,v,f,m,h,p,y,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.viewer.loadExtension("Autodesk.Viewing.SceneBuilder");case 2:return s=e.sent,e.next=5,s.addNewModel({modelNameOverride:"box",conserveMemory:!1});case 5:c=e.sent,u=new THREE.SphereGeometry(.3,32,16),d=new THREE.TextGeometry("B-".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),v=new THREE.MeshPhongMaterial({color:new THREE.Color(1,0,0)}),f=new THREE.Mesh(d,v),m=new THREE.Mesh(u,v),f.matrix.makeRotationX(-4.7),f.matrix.setPosition(new THREE.Vector3(0,.5,1)),f.matrix.scale(new THREE.Vector3(.2,.2,.2)),(h=new THREE.Geometry).merge(f.geometry,f.matrix),h.merge(m.geometry,m.matrix),h.computeVertexNormals(),p=(new THREE.BufferGeometry).fromGeometry(h),a.beacon=new THREE.Mesh(p,v),a.beacon.userData.id=t,y=a.idToNumber(t),a.beacon.dbId=parseInt("".concat(5005,y)),c.addMesh(a.beacon),(g=c.model).setPlacementTransform((new THREE.Matrix4).setPosition({x:null!==(r=n[0])&&void 0!==r?r:0,y:null!==(i=n[1])&&void 0!==i?i:0,z:null!==(l=n[2])&&void 0!==l?l:0})),a.objects.set(t,g);case 27:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}()),r(this,"addWindDirection",function(){var e=n(regeneratorRuntime.mark((function e(t){var n,o,r,i,l,s,c,u,d,v,f,m,h,p,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.viewer.loadExtension("Autodesk.Viewing.SceneBuilder");case 2:return n=e.sent,e.next=5,n.addNewModel({modelNameOverride:"windDirection",conserveMemory:!1});case 5:o=e.sent,r=new THREE.MeshBasicMaterial({color:new THREE.Color(.545,.271,.075)}),i=new THREE.TextGeometry("N",{font:"monaco",size:2,height:0,curveSegments:3}),l=new THREE.TextGeometry("S",{font:"monaco",size:2,height:0,curveSegments:3}),s=new THREE.TextGeometry("E",{font:"monaco",size:2,height:0,curveSegments:3}),c=new THREE.TextGeometry("W",{font:"monaco",size:2,height:0,curveSegments:3}),u=Math.PI/180*90,(d=new THREE.Mesh(i,r)).matrix.makeRotationX(u),d.matrix.setPosition(new THREE.Vector3(0,50,1)),(v=new THREE.Mesh(l,r)).matrix.makeRotationX(u),v.matrix.setPosition(new THREE.Vector3(0,-50,1)),(f=new THREE.Mesh(s,r)).matrix.makeRotationX(u),f.matrix.setPosition(new THREE.Vector3(50,0,1)),(m=new THREE.Mesh(c,r)).matrix.makeRotationX(u),m.matrix.setPosition(new THREE.Vector3(-50,0,1)),(h=new THREE.Geometry).merge(d.geometry,d.matrix),h.merge(v.geometry,v.matrix),h.merge(f.geometry,f.matrix),h.merge(m.geometry,m.matrix),h.computeVertexNormals(),p=(new THREE.BufferGeometry).fromGeometry(h),a.windDirection=new THREE.Mesh(p,r),o.addMesh(a.windDirection),y=o.model,a.objects.set(t,y);case 36:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(this,"addGrid",(function(){a.grid=new THREE.GridHelper(50,1),a.grid.material.opacity=.8,a.grid.material.transparent=!0,a.grid.position.set(0,0,0),a.grid.rotateX(Math.PI/2),a.viewer.overlays.hasScene("grid")||a.viewer.overlays.addScene("grid"),a.viewer.overlays.addMesh(a.grid,"grid")})),r(this,"addRestrictedAreaWithText",function(){var e=n(regeneratorRuntime.mark((function e(t,n,o){var r,i,l,s,c,u,d,v,f,m,h,p,y,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.viewer.loadExtension("Autodesk.Viewing.SceneBuilder");case 2:return s=e.sent,e.next=5,s.addNewModel({modelNameOverride:"box",conserveMemory:!1});case 5:c=e.sent,u=new THREE.BoxGeometry(1,1,1),d=new THREE.TextGeometry("R: ".concat(t),{font:"monaco",size:1,height:0,curveSegments:3}),v=new THREE.Geometry,f=new THREE.MeshBasicMaterial({color:new THREE.Color(1,0,0)}),m=new THREE.Mesh(u,f),(h=new THREE.Mesh(d,f)).matrix.makeRotationX(-4.7),h.matrix.setPosition(new THREE.Vector3(0,.5,1)),h.matrix.scale(new THREE.Vector3(.2,.2,.2)),m.matrix.scale(new THREE.Vector3(1,1,1)),v.merge(m.geometry,m.matrix),v.merge(h.geometry,h.matrix),v.computeVertexNormals(),p=(new THREE.BufferGeometry).fromGeometry(v),a.restrictedArea=new THREE.Mesh(p,f),a.restrictedArea.userData.id=t,y=a.idToNumber(t),a.restrictedArea.dbId=y,c.addMesh(a.restrictedArea),(g=c.model).setPlacementTransform((new THREE.Matrix4).setPosition({x:null!==(r=n[0])&&void 0!==r?r:0,y:null!==(i=n[1])&&void 0!==i?i:0,z:null!==(l=n[2])&&void 0!==l?l:0})),a.objects.set(t,g);case 28:case"end":return e.stop()}}),e)})));return function(t,n,o){return e.apply(this,arguments)}}()),r(this,"unloadModel",(function(){var t,n=function(t,n){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,n){if(t){if("string"==typeof t)return e(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){o&&(t=o);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,s=!1;return{s:function(){o=o.call(t)},n:function(){var e=o.next();return l=e.done,e},e:function(e){s=!0,a=e},f:function(){try{l||null==o.return||o.return()}finally{if(s)throw a}}}}(a.objects.values());try{for(n.s();!(t=n.n()).done;){var o=t.value;a.viewer.impl.unloadModel(o)}}catch(e){n.e(e)}finally{n.f()}a.grid&&(a.viewer.overlays.removeMesh(a.grid,"grid"),a.viewer.overlays.removeScene("grid"))})),this.viewer=o,this.options=i,this.aoa=null,this.model=null,this.humanModel=null,this.restrictedArea=null,this.beacon=null,this.excavator=null,this.grid=null,this.objects=new Map}var i,a;return i=t,a=[{key:"idToNumber",value:function(e){var t=parseInt(e);return isNaN(e)&&(t=parseInt(e.replace(/[^0-9]/g,""))),t}},{key:"setFlyTo",value:function(e,t){this.viewer.select([t],e.model),this.viewer.utilities.fitToView()}},{key:"changePosition",value:function(e,t,n,o,r){console.log(t),t.matrix.setPosition(new THREE.Vector3(n,o,r)),e.updateMesh(t)}},{key:"changePositionSpecific",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.objects[t]?(this.objects[t].matrix.setPosition(new THREE.Vector3(n,o,r)),e.updateMesh(this.objects[t])):console.log("there is no object on this scene !")}},{key:"restrictedAreaScale",value:function(e,t,n,o){this.objects[e]?(this.objects[e].matrix.scale(new THREE.Vector3(n,o,1)),t.updateMesh(this.objects[e])):console.log("no object on this scene !")}},{key:"lookAtMe",value:function(e,t){console.log(e),this.objects[t].matrix.makeRotationFromQuaternion(this.viewer.getCamera().clone().quaternion),e.updateMesh(this.objects[t])}}],a&&o(i.prototype,a),t}();function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"distance",(function(t,n){var r=e.degreeToRadian(o.center.latitude),i=e.degreeToRadian(t),a=e.degreeToRadian(t-o.center.latitude),l=e.degreeToRadian(n-o.center.longitude),s=Math.sin(a/2)*Math.sin(a/2)+Math.cos(r)*Math.cos(i)*Math.sin(l/2)*Math.sin(l/2),c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return o.R*c})),l(this,"geographicToCartesian",(function(e,t){var n=o.distance(o.center.latitude,t),r=o.distance(e,o.center.longitude);return o.center.longitude*t>0?o.center.longitude>t&&(n*=-1):o.center.longitude<0&&t>0&&Math.abs(o.center.longitude-t)>180&&(n*=-1),o.center.latitude>e&&(r*=-1),{x:n,y:r}})),l(this,"cartesianToGeographic",(function(e,t){var n=Math.PI,r=e/1e3,i=t/1e3;return{latitude:o.center.latitude+i/6378*(180/n),longitude:o.center.longitude+r/6378*(180/n)/Math.cos(o.center.latitude*n/180)}})),l(this,"setCoordinateBuilding",(function(){for(var e=[[0,0],[0,0],[0,0],[0,0]],t=0;t<o.BUILDING_CORNER_LOCATION.length;t+=1)e[t]=o.cartesianToGeographic(o.BUILDING_CORNER_LOCATION[t][0],o.BUILDING_CORNER_LOCATION[t][1]);return e})),l(this,"geographicToCartesian2D",(function(e){for(var t=[],n=0;n<e.length;n++)t.push(o.geographicToCartesian(e[n][1],e[n][0]));return t})),this.center={latitude:t,longitude:n},this.R=6371e3}var t,n,o;return t=e,o=[{key:"degreeToRadian",value:function(e){return e*Math.PI/180}},{key:"forgeCoodinateToCartesianCoordinate",value:function(e){return{x:e[0],y:e[1],z:e[2]}}},{key:"toForgeCoordinate",value:function(e){return{x:e.x,y:e.y}}}],(n=[{key:"getCenter",value:function(){return this.center}},{key:"setCenter",value:function(e,t){this.cente={latitude:e,longitude:t}}},{key:"calculateUWBPosition",value:function(e,t,n,o,r){var i=e/100,a=(-t+n)*Math.PI/180,l=i*Math.cos(a),s=i*Math.sin(a);return[l+=o,s+=r]}},{key:"toLatitudeLongitudeEveryCorner",value:function(e){for(var t=[[0,0],[0,0],[0,0],[0,0]],n=0;n<e[0].length;n+=1)t[n]=this.cartesianToGeographic(e[0][n],e[1][n]);return t}}])&&a(t.prototype,n),o&&a(t,o),e}();function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.container=n}var t,n;return t=e,(n=[{key:"darkModeToolSetup",value:function(){var e=this,t=document.createElement("div"),n=document.createElement("input"),o=document.createElement("label");o.innerText="Dark Mode",this.setAttributes(n,{type:"checkbox",id:"toggleDarkmode"}),t.append(n,o),n.addEventListener("change",(function(){n.checked?e.activate():e.deactivate()})),this.container.append(t)}},{key:"activate",value:function(){console.log("dark mode activate"),this.viewer.setBackgroundColor(0,0,0,61,61,61)}},{key:"deactivate",value:function(){console.log("dark mode deactivate"),this.viewer.setBackgroundColor(255,255,255,255,255,255)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}}])&&c(t.prototype,n),e}();function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function h(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}var g="xform-tool-overlay",E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(a,Autodesk.Viewing.ToolInterface);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=y(o);if(r){var n=y(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return h(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._controls=null,t._viewer=e,t._fragments=[],t._startPosition=new THREE.Vector3,t._startTransform=null,t._onCameraChange=t._onCameraChange.bind(p(t)),t._onControlsChange=t._onControlsChange.bind(p(t)),t._onSelectionChange=t._onSelectionChange.bind(p(t)),t.selectedModel=null,t.names=["xform-tool"],delete t.register,delete t.deregister,delete t.activate,delete t.deactivate,delete t.getPriority,delete t.handleMouseMove,delete t.handleButtonDown,delete t.handleButtonUp,delete t.handleSingleClick,t}return t=a,(n=[{key:"register",value:function(){console.log("TransformTool registered.")}},{key:"deregister",value:function(){console.log("TransformTool unregistered.")}},{key:"activate",value:function(e,t){this._viewer=t,this._controls=new THREE.TransformControls(this._viewer.getCamera(),this._viewer.canvas,"translate"),this._controls.setSize(25),this._controls.visible=!1,this._controls.addEventListener("change",this._onControlsChange),this._controls.attach(new THREE.Object3D),this._viewer.select(null),this._viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this._onCameraChange),this._viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this._onSelectionChange),this._viewer.overlays.addScene(g),this._viewer.overlays.addMesh(this._controls,g),console.log("TransformTool activated.")}},{key:"deactivate",value:function(e){this._viewer.overlays.removeMesh(this._controls,g),this._viewer.overlays.removeScene(g),this._viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this._onCameraChange),this._viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this._onSelectionChange),this._controls.removeEventListener("change",this._onControlsChange),this._viewer=null,this._controls=null,console.log("TransformTool deactivated.")}},{key:"getPriority",value:function(){return 42}},{key:"update",value:function(e){return!1}},{key:"handleMouseMove",value:function(e){return this._dragging?this._controls.onPointerMove(e):this._controls.onPointerHover(e)}},{key:"handleButtonDown",value:function(e,t){return this._dragging=!0,this._controls.onPointerDown(e)}},{key:"handleButtonUp",value:function(e,t){return this._dragging=!1,this._controls.onPointerUp(e)}},{key:"handleSingleClick",value:function(e,t){return!1}},{key:"_onCameraChange",value:function(){this._controls.update()}},{key:"_onControlsChange",value:function(e){var t=(new THREE.Vector3).subVectors(this._controls.position,this._startPosition);if(this.selectedModel){var n=this._startTransform.clone();n.elements[12]+=t.x,n.elements[13]+=t.y,n.elements[14]+=t.z,this.selectedModel.setPlacementTransform(n),this._viewer.impl.invalidate(!0,!0,!0)}}},{key:"_onSelectionChange",value:function(e){var t=e.selections[0];if(t){if("500"!==t.dbIdArray[0].toString().slice(0,3))return;var n=t.model;this.selectedModel=n;var o=t.dbIdArray[0],r=n.getData().instanceTree,i=n.getFragmentList(),a=new THREE.Box3;r.enumNodeFragments(o,(function(e){var t=new THREE.Box3;i.getWorldBounds(e,t),a.union(t)}),!0);var l=a.getCenter();this._controls.setPosition(l),this._startPosition.copy(this._controls.position),this._startTransform=n.getPlacementTransform().clone(),this._controls.visible=!0}else this._controls.visible=!1,this.selectedModel=null}},{key:"_computeBounds",value:function(e,t){var n,o=e.getFragmentList(),r=new THREE.Box3,i=new THREE.Box3,a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw i}}}}(t);try{for(a.s();!(n=a.n()).done;){var l=n.value;o.getWorldBounds(l,i),r.union(i)}}catch(e){a.e(e)}finally{a.f()}return r}}])&&f(t.prototype,n),a}();function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var w="xform-tool",T=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.container=n,this._tool=null}var t,n;return t=e,(n=[{key:"transformToolSetup",value:function(){var e=this,t=document.createElement("div"),n=document.createElement("input"),o=document.createElement("label");o.innerText="AOA Transform",this.setAttributes(n,{type:"checkbox",id:"toggleTransformTool"}),t.append(n,o),n.addEventListener("change",(function(){n.checked?e._enableTransformTool():e._disableTransformTool()})),this.container.append(t)}},{key:"_enableTransformTool",value:function(){alert("Please select a AOA in the scene.");var e=this.viewer.toolController;this._tool||(this._tool=new E,e.registerTool(this._tool)),e.isToolActivated(w)||e.activateTool(w)}},{key:"_disableTransformTool",value:function(){var e=this.viewer.toolController;this._tool&&e.isToolActivated(w)&&e.deactivateTool(w)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}}])&&b(t.prototype,n),e}();function R(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var A=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.container=n,this.infoCard=null,this.enabledIcon=!1,this.selectedModelCard=null}var t,n;return t=e,(n=[{key:"updateIconEvent",value:function(){var e=this,t=function(){e.enabledIcon&&e.updateIcons()};this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,t),this.viewer.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,t),this.viewer.addEventListener(Autodesk.Viewing.HIDE_EVENT,t),this.viewer.addEventListener(Autodesk.Viewing.SHOW_EVENT,t)}},{key:"unload",value:function(){console.log("unload")}},{key:"infoCardSetup",value:function(){var e=this,t=document.createElement("div"),n=document.createElement("input"),o=document.createElement("label");o.innerText="Info Card",this.setAttributes(n,{type:"checkbox",id:"toggleInfoModel"}),t.append(n,o),n.addEventListener("change",(function(){n.checked?(e.enabledIcon=!0,console.log("infoCard activated")):(e.enabledIcon=!1,console.log("InfoCard deactivated"),e.clearInfoCard())})),this.container.append(t)}},{key:"showIcon",value:function(e,t,n){if(this.posModel=n,this.enabledIcon){this.infoCard=document.createElement("div"),this.infoCard.setAttribute("class","labelModel"),this.infoCard.setAttribute("data-id","".concat(e));var o=document.createElement("div");o.id="infoData",t&&(o.innerHTML='\n      <div>ID: <span id="infoId">'.concat(t.id,'</span></div>\n      <div>Position: <span id="infoPosition" >').concat(t.position,'</span></div>\n      <div>Rotation: <span id="infoRotation" >').concat(t.rotation,'</span></div>\n      <div>Lat: <span id="infoLatitude" >').concat(t.latitude,'</span></div>\n      <div>Long: <span id="infoLongitude" class="info">').concat(t.longitude,"</span></div>\n      ")),this.infoCard.append(o),document.querySelector("#".concat(this.viewer.clientContainer.id)).appendChild(this.infoCard),this.updateIcons()}}},{key:"updateIcons",value:function(){if(this.infoCard&&this.posModel){var e=this.viewer.worldToClient(this.posModel);if(this.infoCard.style.left="".concat(Math.floor(50+e.x-this.infoCard.offsetWidth/2),"px"),this.infoCard.style.top="".concat(Math.floor(50+e.y-this.infoCard.offsetWidth/2),"px"),this.selectedModelCard){var t=this.checkIfOutofContainer();this.infoCard.style.display=t?"block":"none"}}}},{key:"checkIfOutofContainer",value:function(){if(this.selectedModelCard){var e=this.viewer.getCamera(),t=(new THREE.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),n=(new THREE.Frustum).setFromMatrix(t),o=this.selectedModelCard.getBoundingBox();return n.intersectsBox(o)}}},{key:"selectedModel",value:function(e){this.selectedModelCard=e}},{key:"clearInfoCard",value:function(){this.infoCard&&this.infoCard.remove()}},{key:"clear",value:function(){this.infoCard=null}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}}])&&R(t.prototype,n),e}();function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var M=function(){function e(t,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.container=n,this.options=o,this.beeController=r.controllerModel,this.selectedModel=null,this.aoa={id:"4219",position:[0,0,7],rotation:[0,0,0]},this.id_AOA=null}var t,n;return t=e,(n=[{key:"AOAsetup",value:function(){var e=document.createElement("div");e.innerHTML='\n    <div class="container-bee">\n    <button type="button" class="collapsible"><div class="glyphicon glyphicon-modal-window"/><span>AOA Setup</span></button>\n    <div class="content">\n      <div class="aoa-bee">\n        <form id="form-add-aoa">\n          <input\n            type="text"\n            name="aoa-id"\n            id="aoa-id"\n            class="input-position"\n          />\n          <label for="aoa-id">aoa-tag</label>\n          <button class="button-bee-aoa aoa-config" id="create-aoa">\n            ADD\n          </button>\n        </form>\n        <button class="button-bee-aoa aoa-config" id="delete-aoa">DELETE</button>\n      </div>\n      <form id="form-edit-aoa">\n        <div>\n          <input\n            type="number"\n            name="x"\n            id="x"\n            value="0"\n            class="input-position"\n          />\n          <label for="x">x (m)</label>\n        </div>\n        <div>\n          <input\n            type="number"\n            name="y"\n            id="y"\n            value="0"\n            class="input-position"\n          />\n          <label for="y">y (m)</label>\n        </div>\n        <div>\n          <input\n            type="number"\n            name="z"\n            id="z"\n            value="0"\n            class="input-position"\n          />\n          <label for="z">z (m)</label>\n        </div>\n        <div>\n          <input\n            type="number"\n            name="angle"\n            id="angle"\n            value="0"\n            class="input-position"\n          />\n          <label for="angle">angle (&deg)</label>\n        </div>\n        <button type="submit" class="button-bee">SET</button>\n      </form>\n    </div>\n  </div>\n    ',this.container.append(e)}},{key:"AOAexistence",value:function(){var e=this,t=document.getElementById("form-add-aoa");if(t){t.addEventListener("submit",(function(n){var o;n.preventDefault(),e.id_AOA=t.elements.namedItem("aoa-id").value,""!==e.id_AOA&&void 0!==e.id_AOA?e.beeController.addAOA(null!==(o=e.id_AOA)&&void 0!==o?o:e.aoa.position,e.aoa.position,e.aoa.rotation):alert("Id is not correct")}));var n=document.getElementById("delete-aoa");n&&n.addEventListener("click",(function(){e.selectedModel?e.viewer.impl.unloadModel(e.selectedModel):alert("There is no AOA selected!")}))}}},{key:"updateAOA",value:function(){var e=this,t=document.getElementById("form-edit-aoa");t&&t.addEventListener("submit",(function(n){if(n.preventDefault(),e.valueAOA_X=t.elements.namedItem("x").value,e.valueAOA_Y=t.elements.namedItem("y").value,e.valueAOA_Z=t.elements.namedItem("z").value,e.valueAOA_Rotation=t.elements.namedItem("angle").value,!(isNaN(e.valueAOA_X)||""===e.valueAOA_X||void 0===e.valueAOA_X||isNaN(e.valueAOA_Y)||""===e.valueAOA_Y||void 0===e.valueAOA_Y||isNaN(e.valueAOA_Z)||""===e.valueAOA_Z||void 0===e.valueAOA_Z||isNaN(e.valueAOA_Rotation)||""===e.valueAOA_Rotation||void 0===e.valueAOA_Rotation))if(e.selectedModel){var o=(new THREE.Matrix4).makeTranslation(e.valueAOA_X,e.valueAOA_Y,e.valueAOA_Z),r=s.degreeToRadian(e.valueAOA_Rotation),i=(new THREE.Matrix4).makeRotationZ(r);e.selectedModel.setPlacementTransform(o.multiply(i))}else alert("There is no AOA selected")}))}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}},{key:"AOASelected",value:function(e){this.selectedModel=e}},{key:"AOAclear",value:function(){this.selectedModel=null}}])&&x(t.prototype,n),e}();function k(e,t,n,o,r,i,a){try{var l=e[i](a),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(o,r)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){k(i,o,r,a,l,"next",e)}function l(e){k(i,o,r,a,l,"throw",e)}a(void 0)}))}}function _(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var H=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.container=n}var t,n;return t=e,(n=[{key:"buildingSetup",value:function(){var e=document.createElement("div");e.innerHTML='\n    <div class="container-bee">\n    <button type="button" class="collapsible"><div class="glyphicon glyphicon-blackboard"/><span>Building Setup</span></button>\n    <div class="content">\n      <div class="latlong-bee">\n        <div id="lat-bee">Lat :</div>\n        <div id="long-bee">Long :</div>\n      </div>\n\n      <form id="form-building">\n        <div>\n          <input\n            type="number"\n            name="x"\n            id="x"\n            value="0"\n            class="input-position"\n          />\n          <label for="x">x (m)</label>\n        </div>\n        <div>\n          <input\n            type="number"\n            name="y"\n            id="y"\n            value="0"\n            class="input-position"\n          />\n          <label for="y">y (m)</label>\n        </div>\n        <div>\n          <input\n            type="number"\n            name="z"\n            id="z"\n            value="0"\n            class="input-position"\n          />\n          <label for="z">z (m)</label>\n        </div>\n\n        <div>\n          <input\n            type="number"\n            name="angle"\n            id="angle"\n            value="0"\n            class="input-position"\n          />\n          <label for="angle">angle (&deg)</label>\n        </div>\n        <button type="submit" class="button-bee">SET</button>\n      </form>\n      <div class="button-bee" id="button-show-hide-building">HIDE BUILDING\n      <div class="glyphicon glyphicon-eye-close"/>\n      </div>\n    </div>\n  </div>\n    ',this.container.append(e)}},{key:"updateBuilding",value:function(){var e=this,t=document.getElementById("form-building");t&&t.addEventListener("submit",(function(n){if(n.preventDefault(),e.valueX=t.elements.namedItem("x").value,e.valueY=t.elements.namedItem("y").value,e.valueZ=t.elements.namedItem("z").value,e.valueRot=t.elements.namedItem("angle").value,!(isNaN(e.valueX)||""===e.valueX||void 0===e.valueX||isNaN(e.valueY)||""===e.valueY||void 0===e.valueY||isNaN(e.valueZ)||""===e.valueZ||void 0===e.valueZ||isNaN(e.valueRot)||""===e.valueRot||void 0===e.valueRot)){var o=e.viewer.model.getPlacementTransform().clone(),r=(new THREE.Matrix4).makeTranslation(e.valueX,e.valueY,e.valueZ),i=s.degreeToRadian(e.valueRot),a=(new THREE.Matrix4).makeRotationZ(i);o.multiply(r),o.multiply(a),e.viewer.model.setPlacementTransform(o)}}))}},{key:"updateLatLong",value:function(e){var t=document.getElementById("lat-bee"),n=document.getElementById("long-bee");t&&n&&(t.innerText="Lat : ".concat(e.latitude),n.innerText="Long: ".concat(e.longitude))}},{key:"updateVisibility",value:function(){var e=this,t=document.getElementById("button-show-hide-building");t&&t.addEventListener("click",C(regeneratorRuntime.mark((function t(){var n,o,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.enabled=!e.enabled,e.enabled?(n=e.viewer.model.getData().instanceTree,o=n.getRootId(),e.viewer.hide(o)):(r=e.viewer.model.getData().instanceTree,i=r.getRootId(),e.viewer.show(i));case 2:case"end":return t.stop()}}),t)}))))}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}}])&&_(t.prototype,n),e}();function I(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var O=function(){function e(t,n){var o,r,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(){i.started&&requestAnimationFrame(i.rotateCamera);var e=i.viewer.navigation,t=e.getCameraUpVector(),n=new THREE.Vector3(0,0,1),o=10*Math.PI/180,r=(new THREE.Matrix4).makeRotationAxis(n,.03*o),a=e.getPosition();a.applyMatrix4(r),t.applyMatrix4(r),e.setView(a,new THREE.Vector3(0,0,0)),e.setCameraUpVector(t),i.viewer.getState()},(o="rotateCamera")in this?Object.defineProperty(this,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[o]=r,this.viewer=t,this.container=n,this.started=!1}var t,n;return t=e,(n=[{key:"rotateCameraSetup",value:function(){var e=this,t=document.createElement("div"),n=document.createElement("input"),o=document.createElement("label");o.innerText="Rotate Camera",this.setAttributes(n,{type:"checkbox",id:"toggleRotate"}),t.append(n,o),n.addEventListener("change",(function(){n.checked?(e.started=!0,e.rotateCamera(),console.log("activate rotated camera")):(e.started=!1,console.log("unactivate rotated camera"))})),this.container.append(t)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}}])&&I(t.prototype,n),e}();function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var S=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.option=n,this.beeController=o.controllerModel,this.coordinateConverter=o.converter}var t,n;return t=e,(n=[{key:"setupInitialModel",value:function(){this.initRestrictedArea(),this.initWorker(),this.initExcavator()}},{key:"initRestrictedArea",value:function(){var e=this.coordinateConverter.geographicToCartesian2D([[121.51998,25.07044],[121.51981,25.0702],[121.52,25.06996],[121.5202,25.07019],[121.52051,25.07027],[121.52035,25.07043]]);this.beeController.addCustomRestrictedArea("E143231A43",e,5)}},{key:"initExcavator",value:function(){this.beeController.addExcavator("E1231A43",[5,20,0],[0,0,0])}},{key:"initWorker",value:function(){this.beeController.addNewWorker("12A312",[10,10,0],[0,0,0])}},{key:"initBeacon",value:function(){this.beeController.addBeacon("E143231A43",[-5,10,0],[0,0,0])}},{key:"gridAndWindDirection",value:function(){this.beeController.addGrid(),this.beeController.addWindDirection(1233)}}])&&P(t.prototype,n),e}();function N(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var B,V,G,j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"getTypeOfModel",value:function(e){var t="";switch(e.slice(0,4)){case"5001":t=e.replace(/^.{4}/g,"AOA-");break;case"5002":t=e.replace(/^.{4}/g,"Worker-");break;case"5003":t=e.replace(/^.{4}/g,"RA-");break;case"5004":t=e.replace(/^.{4}/g,"EXT-");break;case"5005":t=e.replace(/^.{4}/g,"BCN-");break;default:t=e}return{idDevice:t}}},{key:"idToNumber",value:function(e){return parseInt(e.replace(/[^0-9]/g,""))}},{key:"getRotationModel",value:function(e){var t,n=e.elements[0],o=e.elements[1];return(t=n||o?Math.atan2(o,n):0)<0&&(t+=2*Math.PI),{angle:Math.round(t*(180/Math.PI))}}}],null&&N(t.prototype,null),n&&N(t,n),e}();function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}G=function(e){var t=new THREE.Quaternion;t.setFromRotationMatrix(e);var n=t._w;return{angle:2*Math.acos(n)*180/Math.PI}},(V="quaternionToAngle")in(B=j)?Object.defineProperty(B,V,{value:G,enumerable:!0,configurable:!0,writable:!0}):B[V]=G;var D=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.container=n,this.selectedModelRA=null}var t,n;return t=e,n=[{key:"restrictedAreaSetup",value:function(){var e=document.createElement("div");e.innerHTML='\n    <div class="container-bee">\n    <button type="button" class="collapsible"><div class="glyphicon glyphicon-warning-sign"/><span>Restricted Area Setup</span></button>\n    <div class="content">\n      <form id="form-edit-restricted">\n        <div>\n          <input\n            type="number"\n            name="x"\n            id="x"\n            value="0"\n            class="input-position"\n          />\n          <label for="x">x (m)</label>\n        </div>\n        <div>\n          <input\n            type="number"\n            name="y"\n            id="y"\n            value="0"\n            class="input-position"\n          />\n          <label for="y">y (m)</label>\n        </div>\n        <div>\n          <input\n            type="number"\n            name="z"\n            id="z"\n            value="0"\n            class="input-position"\n          />\n          <label for="z">z (m)</label>\n        </div>\n        <div>\n          <input\n            type="number"\n            name="height"\n            id="height"\n            value="0"\n            class="input-position"\n          />\n          <label for="angle">height (m)</label>\n        </div>\n        <button type="submit" class="button-bee">SET</button>\n      </form>\n    </div>\n  </div>\n    ',this.container.append(e)}},{key:"updateREstricted",value:function(){var e=this,t=document.getElementById("form-edit-restricted");t&&t.addEventListener("submit",(function(n){n.preventDefault(),e.valueRA_X=t.elements.namedItem("x").value,e.valueRA_Y=t.elements.namedItem("y").value,e.valueRA_Z=t.elements.namedItem("z").value,e.valueRA_H=t.elements.namedItem("height").value,isNaN(e.valueRA_X)||""===e.valueRA_X||void 0===e.valueRA_X||isNaN(e.valueRA_Y)||""===e.valueRA_Y||void 0===e.valueRA_Y||isNaN(e.valueRA_Z)||""===e.valueRA_Z||void 0===e.valueRA_Z||isNaN(e.valueRA_H)||""===e.valueRA_H||void 0===e.valueRA_H||e.selectedModelRA&&(e.translation=(new THREE.Matrix4).makeTranslation(e.valueRA_X,e.valueRA_Y,e.valueRA_Z),e.scale=(new THREE.Matrix4).scale(new THREE.Vector3(1,1,e.valueRA_H)),e.selectedModelRA.setPlacementTransform(e.translation.multiply(e.scale)))}))}},{key:"RASelected",value:function(e){this.selectedModelRA=e}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}}],n&&L(t.prototype,n),e}();function z(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var X=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.container=n}var t,n;return t=e,(n=[{key:"objectInfoSetup",value:function(){var e=document.createElement("div");e.innerHTML='\n    <div class="container-bee">\n      <button type="button" class="collapsible"><div class="glyphicon glyphicon-tags"/><span>Object Info</span></button>\n      <div class="content">\n        <div>Objet Info</div>\n        <div>ID: <span id="infoId"></span></div>\n        <div>Position: <span id="infoPosition"></span></div>\n        <div>Rotation: <span id="infoRotation"></span></div>\n        <div>Latitude: <span id="infoLatitude"></span></div>\n        <div>Longitude: <span id="infoLongitude" class="info"></span></div>\n      </div>\n    </div>\n        ',this.container.append(e)}},{key:"updateInfo",value:function(e){this.infoId=document.getElementById("infoId"),this.infoPosition=document.getElementById("infoPosition"),this.infoRotation=document.getElementById("infoRotation"),this.infoLatitude=document.getElementById("infoLatitude"),this.infoLongitude=document.getElementById("infoLongitude"),this.infoId.innerText=e.id,this.infoLatitude.innerText=e.latitude,this.infoLongitude.innerText=e.longitude,this.infoPosition.innerText=e.position,this.infoRotation.innerText=e.rotation}},{key:"clearInfo",value:function(){this.infoLatitude&&(this.infoLatitude.innerText=""),this.infoLongitude&&(this.infoLongitude.innerText=""),this.infoId&&(this.infoId.innerText=""),this.infoPosition&&(this.infoPosition.innerText=""),this.infoRotation&&(this.infoRotation.innerText="")}}])&&z(t.prototype,n),e}();function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function U(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Y(e,t){return Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Y(e,t)}function Z(e,t){if(t&&("object"===W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return F(e)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}var Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(l,Autodesk.Viewing.UI.DockingPanel);var t,n,o,r,a=(o=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=q(o);if(r){var n=q(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Z(this,e)});function l(e,t,n,o,r){var c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(c=a.call(this,t,n,o,r)).viewer=e,c.options=r,c.container.classList.add("docking-panel-container-solid-color-a"),c.container.style.cssText="\n      top: 10px;\n      left: 10px;\n      width: 300px;\n      padding: 10px;\n      height: 500px;\n      resize: auto;\n    ",c.containerInfo=document.createElement("div"),c.containerInfo.className="containerInfo",c.container.append(c.containerInfo);var d=document.createElement("div");return d.className="generalTool",d.innerHTML='\n    <div class="container-bee">\n       <button type="button" class="collapsible"><div class="glyphicon glyphicon-tasks"/><span>General Tool</span></button>\n       <div class="content" id="containerGeneralTool"></div>\n    </div>\n    ',c.container.append(d),c.containerGeneralTool=document.getElementById("containerGeneralTool"),c.containerBuilding=document.createElement("div"),c.containerBuilding.className="containerBuilding",c.container.append(c.containerBuilding),c.containerAOA=document.createElement("div"),c.containerAOA.className="containerAOA",c.container.append(c.containerAOA),c.containerRestrictedArea=document.createElement("div"),c.containerRestrictedArea.className="containerRA",c.container.append(c.containerRestrictedArea),c.selectedModel=null,c.selectedModelRotation=null,c.aoa={id:"4219",position:[0,0,2],rotation:[0,0,0]},c.viewerContainer=document.querySelector("#".concat(c.viewer.clientContainer.id)),c.onSelection=c.onSelection.bind(F(c)),c.viewer.addEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,c.onSelection),c.socket=io("http://localhost:3333"),c.beeController=new i(c.viewer,c.options),c.coordinateConverter=new s(25.069771049083982,121.52045303099948),c.initModel=new S(c.viewer,c.options,{converter:c.coordinateConverter,controllerModel:c.beeController}),c.initModel.gridAndWindDirection(),c.initModel.setupInitialModel(),c.getDataUWB(),c.objectInfo=new X(c.viewer,c.containerInfo),c.objectInfo.objectInfoSetup(),c.geoBuilding=c.coordinateConverter.getCenter(),c.buildingTool=new H(c.viewer,c.containerBuilding),c.buildingTool.buildingSetup(),c.buildingTool.updateBuilding(),c.buildingTool.updateLatLong(c.geoBuilding),c.buildingTool.updateVisibility(),c.setupAOA=new M(c.viewer,c.containerAOA,c.options,{controllerModel:c.beeController}),c.setupAOA.AOAsetup(c.selectedModel),c.setupAOA.updateAOA(),c.setupAOA.AOAexistence(),c.infoCardTool=new A(c.viewer,c.containerGeneralTool),c.infoCardTool.infoCardSetup(),c.infoCardTool.updateIconEvent(c.posModel),c.transformTool=new T(c.viewer,c.containerGeneralTool),c.transformTool.transformToolSetup(),c.darkMode=new u(c.viewer,c.containerGeneralTool),c.darkMode.darkModeToolSetup(),c.rotateCamera=new O(c.viewer,c.containerGeneralTool),c.rotateCamera.rotateCameraSetup(),c.restrictedArea=new D(c.viewer,c.containerRestrictedArea),c.restrictedArea.restrictedAreaSetup(),c.restrictedArea.updateREstricted(),c.collapseButton(),c}return t=l,n=[{key:"collapseButton",value:function(){var e=document.getElementsByClassName("collapsible");if(e)for(var t=function(t){e[t].addEventListener("click",(function(){e[t].classList.toggle("activesetup");var n=e[t].nextElementSibling;"block"===n.style.display?n.style.display="none":n.style.display="block"}))},n=0;n<e.length;n++)t(n)}},{key:"onSelection",value:function(e){var t=e.selections[0];if(this.infoCardTool.clearInfoCard(),t){if("500"!==t.dbIdArray[0].toString().slice(0,3))return;var n=t.model;this.selectedModel=n;var o=new THREE.Vector3,r=new THREE.Quaternion,i=new THREE.Vector3;n.getPlacementTransform().decompose(o,r,i);var a=n.getPlacementTransform(),l=j.getRotationModel(a);this.selectedModelRotation=l;var s=t.dbIdArray[0],c=n.getData().instanceTree,u=n.getFragmentList(),d=new THREE.Box3;c.enumNodeFragments(s,(function(e){var t=new THREE.Box3;u.getWorldBounds(e,t),d.union(t)}),!0),this.posModel=d.getCenter();var v=this.coordinateConverter.cartesianToGeographic(this.posModel.x,this.posModel.y),f={id:j.getTypeOfModel(s.toString()).idDevice,position:"".concat(Math.floor(this.posModel.x),",").concat(Math.floor(this.posModel.y),",").concat(Math.floor(this.posModel.z)),rotation:"".concat(Math.floor(l.angle)),latitude:v.latitude,longitude:v.longitude};this.objectInfo.updateInfo(f),this.restrictedArea.RASelected(n),this.infoCardTool.showIcon(s,f,this.posModel),this.infoCardTool.selectedModel(n),this.setupAOA.AOASelected(this.selectedModel)}else this.selectedModel=null,this.objectInfo.clearInfo(),this.infoCardTool.clearInfoCard()}},{key:"getDataUWB",value:function(){var e=this;this.socket.on("UpdateUWB",(function(t){e.getDatasUWB(t)})),this.socket.on("UpdateWorker",(function(t){e.getDatas(t)}))}},{key:"getDatasUWB",value:function(e){var t=e,n=this.setupAOA.id_AOA,o=this.beeController.objects.get(n);if(o){var r,i,a,l=o.getPlacementTransform(),s={position:{x:l.elements[12],y:l.elements[13],z:l.elements[14]},rotation:{x:0,y:0,z:j.getRotationModel(l).angle}},c=this.coordinateConverter.calculateUWBPosition(t.position.distance,t.position.degree,s.rotation.z,s.position.x,s.position.y);this.beeController.objects.has(t.id)?this.beeController.objects.get(t.id).setPlacementTransform((new THREE.Matrix4).setPosition({x:null!==(r=c[0])&&void 0!==r?r:0,y:null!==(i=c[1])&&void 0!==i?i:0,z:null!==(a=s.position.z-2)&&void 0!==a?a:0})):this.beeController.addNewWorker(t.id,c)}}},{key:"getDatas",value:function(e){this.coordinateConverter.cartesianToGeographic(e.position[0],e.position[1]);var t,n,o,r=this.coordinateConverter.geographicToCartesian(e.positionPlant[0],e.positionPlant[1]),i=this.beeController.objects;i.has(e.id)?i.get(e.id).setPlacementTransform((new THREE.Matrix4).setPosition({x:e.position[0],y:e.position[1],z:e.position[2]})):this.beeController.addNewWorker(e.id,e.position),i.has(e.idPlant)?i.get(e.idPlant).setPlacementTransform((new THREE.Matrix4).setPosition({x:null!==(t=r.x)&&void 0!==t?t:0,y:null!==(n=r.y)&&void 0!==n?n:0,z:null!==(o=r.z)&&void 0!==o?o:0})):this.beeController.addExcavator(e.idPlant,r)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}},{key:"uninitialize",value:function(){console.info("uninitialize"),this.socket.close(),this.viewer.removeEventListener(Autodesk.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onSelection),this.beeController.unloadModel()}},{key:"handleAOAbyMouse",value:function(){var e=this;document.onmousemove=function(t){if(t.ctrlKey){var n,o=document.querySelector("#".concat(e.viewer.clientContainer.id)).getBoundingClientRect(),r=e.viewer.impl.hitTest(t.clientX-o.left,t.clientY-o.top,!0,null,[e.viewer.model.getModelId()]);n=r?r.intersectPoint:viewer.impl.intersectGround(t.clientX-o.left,t.clientY-o.top);var i=e.selectedModel.getPlacementTransform();i.elements[12]=n.x,i.elements[13]=n.y,i.elements[14]=n.z,e.selectedModel.setPlacementTransform(i),e.viewer.impl.invalidate(!0,!0,!0)}}}}],n&&U(t.prototype,n),l}();function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function K(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function J(e,t){return J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},J(e,t)}function ee(e,t){if(t&&("object"===$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function te(e){return te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},te(e)}var ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(a,Autodesk.Viewing.Extension);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=te(o);if(r){var n=te(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ee(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e,t)).viewer=e,n.options=t,n._button=null,n._group=null,n.panel=null,n.grid=null,n.destroy=null,n}return t=a,(n=[{key:"load",value:function(){return console.log("Docking Panel has been loaded !"),!0}},{key:"unload",value:function(){return console.log("Docking Panel has been unloaded !"),null!==this.viewer.toolbar&&this.viewer.toolbar.removeControl(this.subToolbar),null!==this.panel&&this.panel.setVisible(!1),this._group&&(this._group.removeControl(this._button),0===this._group.getNumberOfControls()&&this.viewer.toolbar.removeControl(this._group)),!0}},{key:"onToolbarCreated",value:function(){var e=this;this._group=this.viewer.toolbar.getControl("BeeInventorToolbar"),this._group||(this._group=new Autodesk.Viewing.UI.ControlGroup("BeeInventorToolbar"),this.viewer.toolbar.addControl(this._group)),this._button=new Autodesk.Viewing.UI.Button("Docking Panel"),this._button.onClick=function(){null===e.panel&&(e.panel=new Q(e.viewer,e.viewer.container,"beeInventor","BeeInventor Extension")),e.panel.setVisible(!e.panel.isVisible())},this._button.setToolTip("BeeInventor IoT"),this._button.addClass("dockingPanel"),this._group.addControl(this._button)}}])&&K(t.prototype,n),a}();Autodesk.Viewing.theExtensionManager.registerExtension("BeeInventor",ne)})();
//# sourceMappingURL=beeinventor-extension.js.map